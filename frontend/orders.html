<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartStock - The Inventory Management System</title>
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        header {
            background-color: #333;
            color: white;
            padding: 10px 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h2 {
            border-bottom: 2px solid #f2f2f2;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .actions {
            display: flex;
            gap: 10px;
        }
        .btn-danger {
            background-color: #f44336;
        }
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        .btn-info {
            background-color: #2196F3;
        }
        .btn-info:hover {
            background-color: #0b7dda;
        }
        .btn-warning {
            background-color: #ff9800;
        }
        .btn-warning:hover {
            background-color: #e68a00;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            text-transform: uppercase;
        }
        .status-pending {
            background-color: #ffeb3b;
            color: #333;
        }
        .status-completed {
            background-color: #4CAF50;
            color: white;
        }
        .status-cancelled {
            background-color: #f44336;
            color: white;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        /* Detail View Styles */
        .detail-row {
            display: flex;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .detail-label {
            font-weight: bold;
            width: 150px;
        }
        .detail-value {
            flex: 1;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 5px;
            width: 60%;
            max-width: 500px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Navigation Styles */
        .nav-links {
            display: flex;
            justify-content: center;
            background-color: #444;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        .nav-links a:hover {
            background-color: #4CAF50;
        }
        .nav-links a.active {
            background-color: #4CAF50;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
                margin: 0;
                border-radius: 0;
            }
            
            header {
                padding: 8px 15px;
                margin-bottom: 15px;
            }
            
            header h1 {
                font-size: 20px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                gap: 5px;
                padding: 8px;
            }
            
            .nav-links a {
                padding: 6px 10px;
                margin: 2px;
                font-size: 12px;
                flex: 1;
                min-width: 80px;
                text-align: center;
            }
            
            h2 {
                font-size: 18px;
                margin-top: 20px;
            }
            
            h3 {
                font-size: 16px;
            }
            
            /* Responsive Table */
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 6px;
            }
            
            .actions {
                flex-direction: column;
                gap: 5px;
            }
            
            .actions button {
                padding: 6px 8px;
                font-size: 11px;
                margin: 0;
                width: 100%;
                margin-bottom: 10px; 
            }
            
            /* Form Responsive */
            .form-group {
                margin-bottom: 12px;
            }
            
            input, select, textarea {
                padding: 10px;
                font-size: 14px;
            }
            
            button {
                padding: 12px 20px;
                font-size: 14px;
                margin-bottom: 10px;
                width: 100%;
            }
            
            /* Modal Responsive */
            .modal-content {
                width: 90%;
                margin: 5% auto;
                padding: 15px;
            }
            
            .close {
                font-size: 24px;
            }
            
            /* Status Badges */
            .status-badge {
                padding: 4px 8px;
                font-size: 11px;
            }

            #orders-table td.actions {
            white-space: normal;
            padding-left: 0;
            padding-right: 0;
            }

            #orders-table td.actions::before {
            display: none;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 10px;
            }
            
            .nav-links {
                flex-direction: column;
            }
            
            .nav-links a {
                margin: 1px 0;
                padding: 8px;
            }
            
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 6px 4px;
            }
            
            button {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            input, select, textarea {
                padding: 8px;
                font-size: 13px;
            }
            
            .modal-content {
                width: 95%;
                margin: 2% auto;
                padding: 12px;
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            button {
                min-height: 44px;
            }
            
            .nav-links a {
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .close {
                min-height: 44px;
                min-width: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* Table responsive behavior for very small screens */
        @media (max-width: 600px) {
            #orders-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            #orders-table thead,
            #orders-table tbody,
            #orders-table tr,
            #orders-table th,
            #orders-table td {
                display: block;
            }
            
            #orders-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            #orders-table tr {
                border: 1px solid #ccc;
                margin-bottom: 10px;
                padding: 10px;
                background: #f9f9f9;
            }
            
            #orders-table td {
                border: none;
                position: relative;
                padding-left: 50%;
                text-align: left;
                min-height: 30px;
            }
            
            #orders-table td:before {
                content: attr(data-label) ": ";
                position: absolute;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
            }
            
            .actions {
                position: static;
                width: 100%;
                padding-left: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>SmartStock</h1>
    </header>
    
    <div class="container">
        <div class="nav-links">
            <a href="index.html">Dashboard</a>
            <a href="products.html">Products</a>
            <a href="inventory.html">Inventory</a>
            <a href="orders.html" class="active">Orders</a>
            <a href="suppliers.html">Suppliers</a>
            <a href="sales.html">Sales</a>
            <a href="sales-reports.html">Reports</a>
        </div>
        
        <h2>Order Management</h2>
        
        <div id="order-form-container">
            <h3>Create New Order</h3>
            <form id="order-form">
                <div class="form-group">
                    <label for="product">Product</label>
                    <select id="product" name="product" required>
                        <option value="">Select a product</option>
                        <!-- Products will be loaded here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="quantity">Quantity</label>
                    <input type="number" id="quantity" name="quantity" min="1" required>
                </div>
                <div class="form-group">
                    <label for="supplier">Supplier</label>
                    <select id="supplier" name="supplier">
                        <option value="">Select a supplier (optional)</option>
                        <!-- Suppliers will be loaded here -->
                    </select>
                </div>
                <div class="form-group price-container">
                    <label for="totalPrice">Total Price</label>
                    <input type="number" id="totalPrice" name="totalPrice" step="0.01" min="0" required>
                </div>
                <button type="submit">Create Order</button>
            </form>
        </div>
        
        <h3>Orders List</h3>
        <table id="orders-table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                    <th>Supplier</th>
                    <th>Status</th>
                    <th>Order Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="orders-list">
                <!-- Orders will be loaded here -->
            </tbody>
        </table>
    </div>

    <!-- View Order Details Modal -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>Order Details</h3>
            <div id="order-details-content">
                <!-- Order details will be displayed here -->
            </div>
            <div class="actions" style="margin-top: 20px;">
                <button id="complete-order-btn" class="btn-info" onclick="updateOrderStatus('Completed')">Mark as Completed</button>
                <button id="cancel-order-btn" class="btn-danger" onclick="updateOrderStatus('Cancelled')">Cancel Order</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let orders = [];
        let products = [];
        let suppliers = [];
        let currentOrderId = null;

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Load products and suppliers for the dropdown
            loadProducts();
            loadSuppliers();
            
            // Load orders when page loads
            loadOrders();
            
            // Handle form submission
            document.getElementById('order-form').addEventListener('submit', function(e) {
                e.preventDefault();
                createOrder();
            });

            // Calculate total price when product or quantity changes
            document.getElementById('product').addEventListener('change', calculateTotalPrice);
            document.getElementById('quantity').addEventListener('input', calculateTotalPrice);
        });

        // Function to load products for the dropdown
        function loadProducts() {
            fetch('https://backend-355x.onrender.com/api/products')
                .then(response => response.json())
                .then(data => {
                    products = data;
                    populateProductDropdown();
                })
                .catch(error => {
                    console.error('Error loading products:', error);
                    populateProductDropdown();
                });
        }

        // Function to populate product dropdown
        function populateProductDropdown() {
            const productSelect = document.getElementById('product');
            productSelect.innerHTML = '<option value="">Select a product</option>';
            
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product._id;
                option.textContent = `${product.name} (${product.sku}) - $${product.price.toFixed(2)}`;
                option.dataset.price = product.price;
                productSelect.appendChild(option);
            });
        }

        // Function to load suppliers for the dropdown
        function loadSuppliers() {
            fetch('https://backend-355x.onrender.com/api/suppliers')
                .then(response => response.json())
                .then(data => {
                    suppliers = data;
                    populateSupplierDropdown();
                })
                .catch(error => {
                    console.error('Error loading suppliers:', error);
                    populateSupplierDropdown();
                });
        }

        // Function to populate supplier dropdown
        function populateSupplierDropdown() {
            const supplierSelect = document.getElementById('supplier');
            supplierSelect.innerHTML = '<option value="">Select a supplier (optional)</option>';
            
            suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier._id;
                option.textContent = supplier.name;
                supplierSelect.appendChild(option);
            });
        }

        // Function to calculate total price based on product price and quantity
        function calculateTotalPrice() {
            const productSelect = document.getElementById('product');
            const quantityInput = document.getElementById('quantity');
            const totalPriceInput = document.getElementById('totalPrice');
            
            const selectedOption = productSelect.options[productSelect.selectedIndex];
            const quantity = parseInt(quantityInput.value) || 0;
            
            if (selectedOption && selectedOption.dataset.price) {
                const price = parseFloat(selectedOption.dataset.price);
                const totalPrice = price * quantity;
                totalPriceInput.value = totalPrice.toFixed(2);
            }
        }

        // Function to load orders from API
        function loadOrders() {
            fetch('https://backend-355x.onrender.com/api/orders')
                .then(response => response.json())
                .then(data => {
                    orders = data;
                    displayOrders();
                })
                .catch(error => {
                    console.error('Error loading orders:', error);
                    displayOrders();
                });
        }

        // Function to display orders in the table
        function displayOrders() {
            const ordersList = document.getElementById('orders-list');
            ordersList.innerHTML = '';
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                const orderDate = new Date(order.orderDate).toLocaleDateString();
                
                row.innerHTML = `
                    <td data-label="Product">${order.product.name}</td>
                    <td data-label="Quantity">${order.quantity}</td>
                    <td data-label="Total Price">$${order.totalPrice.toFixed(2)}</td>
                    <td data-label="Supplier">${order.supplier ? order.supplier.name : '-'}</td>
                    <td data-label="Status"><span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span></td>
                    <td data-label="Order Date">${orderDate}</td>
                    <td class="actions" data-label="Actions">
                        <button class="btn-info" onclick="viewOrderDetails('${order._id}')">View</button>
                        ${order.status === 'Pending' ? `<button class="btn-danger" onclick="cancelOrder('${order._id}')">Cancel</button>` : ''}
                    </td>
                `;
                ordersList.appendChild(row);
            });
        }

        // Function to create a new order
        function createOrder() {
            const form = document.getElementById('order-form');
            const productId = form.product.value;
            const quantity = parseInt(form.quantity.value);
            const supplierId = form.supplier.value;
            const totalPrice = parseFloat(form.totalPrice.value);
            
            const order = {
                product: productId,
                quantity: quantity,
                totalPrice: totalPrice,
                supplier: supplierId || null,
                status: 'Pending'
            };
            
            fetch('https://backend-355x.onrender.com/api/orders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(order)
            })
            .then(response => response.json())
            .then(data => {
                alert('Order created successfully!');
                form.reset();
                loadOrders();
            })
            .catch(error => {
                console.error('Error creating order:', error);
                alert('Failed to create order. Please try again.');
                // For demo, add to local array and refresh
                const product = products.find(p => p._id === productId);
                const supplier = supplierId ? suppliers.find(s => s._id === supplierId) : null;
                
                const newOrder = {
                    _id: Date.now().toString(),
                    product: product,
                    quantity: quantity,
                    totalPrice: totalPrice,
                    supplier: supplier,
                    status: 'Pending',
                    orderDate: new Date()
                };
                orders.push(newOrder);
                displayOrders();
                form.reset();
                alert('Order created (demo mode)');
            });
        }

        // Function to view order details
        function viewOrderDetails(orderId) {
            currentOrderId = orderId;
            const order = orders.find(o => o._id === orderId);
            
            if (order) {
                showOrderDetailsModal(order);
            } else {
                fetch(`https://backend-355x.onrender.com/api/orders/${orderId}`)
                    .then(response => response.json())
                    .then(order => {
                        showOrderDetailsModal(order);
                    })
                    .catch(error => {
                        console.error('Error loading order details:', error);
                        alert('Failed to load order details.');
                    });
            }
        }

        // Function to show order details modal
        function showOrderDetailsModal(order) {
            const modal = document.getElementById('orderDetailsModal');
            const content = document.getElementById('order-details-content');
            const completeBtn = document.getElementById('complete-order-btn');
            const cancelBtn = document.getElementById('cancel-order-btn');
            
            // Format the date
            const orderDate = new Date(order.orderDate).toLocaleString();
            
            // Create the details HTML
            content.innerHTML = `
                <div class="detail-row">
                    <div class="detail-label">Order ID:</div>
                    <div class="detail-value">${order._id}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Product:</div>
                    <div class="detail-value">${order.product.name} (${order.product.sku})</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Quantity:</div>
                    <div class="detail-value">${order.quantity}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Total Price:</div>
                    <div class="detail-value">$${order.totalPrice.toFixed(2)}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Supplier:</div>
                    <div class="detail-value">${order.supplier ? order.supplier.name : 'Not specified'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Status:</div>
                    <div class="detail-value">
                        <span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span>
                    </div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Order Date:</div>
                    <div class="detail-value">${orderDate}</div>
                </div>
            `;
            
            // Show/hide action buttons based on order status
            if (order.status === 'Pending') {
                completeBtn.style.display = 'inline-block';
                cancelBtn.style.display = 'inline-block';
            } else {
                completeBtn.style.display = 'none';
                cancelBtn.style.display = 'none';
            }
            
            // Show the modal
            modal.style.display = 'block';
        }

        // Function to close the modal
        function closeModal() {
            const modal = document.getElementById('orderDetailsModal');
            modal.style.display = 'none';
            currentOrderId = null;
        }

        // Function to update order status
        function updateOrderStatus(status) {
            if (!currentOrderId) return;
            
            fetch(`https://backend-355x.onrender.com/api/orders/${currentOrderId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ status })
            })
            .then(response => response.json())
            .then(data => {
                alert(`Order ${status.toLowerCase()} successfully!`);
                closeModal();
                loadOrders();
            })
            .catch(error => {
                console.error('Error updating order status:', error);
                alert('Failed to update order status. Please try again.');
                // For demo, update in local array and refresh
                const orderIndex = orders.findIndex(o => o._id === currentOrderId);
                if (orderIndex !== -1) {
                    orders[orderIndex].status = status;
                    displayOrders();
                    closeModal();
                    alert(`Order ${status.toLowerCase()} (demo mode)`);
                }
            });
        }

        // Function to cancel an order directly from the list
        function cancelOrder(orderId) {
            if (confirm('Are you sure you want to cancel this order?')) {
                currentOrderId = orderId;
                updateOrderStatus('Cancelled');
            }
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('orderDetailsModal');
            if (event.target === modal) {
                closeModal();
            }
        };
    </script>
</body>
</html>